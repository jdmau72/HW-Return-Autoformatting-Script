{"version":"0.3.0","body":"// values used by the whole script\r\nconst MAX_EXCEL_SHEET_SIZE = 1048576;\r\nlet appliedRange: ExcelScript.Range;\r\nlet selectedSheet: ExcelScript.Worksheet;\r\n\r\nlet lotAdjCol: string;\r\nlet notesCol: string;\r\nlet expDateCol: string;\r\nlet itemNumCol: string;\r\n\r\n\r\n/**\r\n@param lotAdjustmentColumn Please select the column for your Lot Adjustments\r\n@param notesColumn Please select the your notes column (where you add MIA, FAIL, etc)\r\n@param hasExpirationDate Do you want to check for expiring items?\r\n@param expDateColumn Please select the column for your expiration dates.\r\n@param itemNumberColumn Please select the column for your item number. \r\n*/\r\nfunction main(workbook: ExcelScript.Workbook, \r\n\t\t\t\t\t\tlotAdjustmentColumn: \"A\" | \"B\" | \"C\" | \"D\" | \"E\" | \"F\" | \"G\" | \"H\" | \"I\" | \"J\" | \"K\" = \"E\",\r\n\t\t\t\t\t\tnotesColumn: \"A\" | \"B\" | \"C\" | \"D\" | \"E\" | \"F\" | \"G\" | \"H\" | \"I\" | \"J\" | \"K\" = \"H\",\r\n\t\t\t\t\t\thasExpirationDate: true | false = false,\r\n\t\t\t\t\t\texpDateColumn: \"A\" | \"B\" | \"C\" | \"D\" | \"E\" | \"F\" | \"G\" | \"H\" | \"I\" | \"J\" | \"K\" = \"G\",\r\n\t\t\t\t\t\titemNumberColumn: \"A\" | \"B\" | \"C\" | \"D\" | \"E\" | \"F\" | \"G\" | \"H\" | \"I\" | \"J\" | \"K\" = \"B\") {\r\n\r\n\tselectedSheet = workbook.getActiveWorksheet();\r\n\tlotAdjCol = lotAdjustmentColumn;\r\n\tnotesCol = notesColumn;\r\n\texpDateCol = expDateColumn;\r\n\titemNumCol = itemNumberColumn;\r\n\t\r\n\t// gets the range of columns actually used for nicer formatting\r\n\tlet usedRange = selectedSheet.getUsedRange();\r\n\tlet usedRangeAddress = usedRange.getAddress().split(\"!\")[1].split(\":\");\r\n\tlet leftColumn = usedRangeAddress[0][0];\r\n\tlet rightColumn = usedRangeAddress[1][0];\r\n\t// console.log(usedRangeAddress);\r\n\tappliedRange = selectedSheet.getRange(\r\n\t\tleftColumn + \"1:\" + rightColumn + MAX_EXCEL_SHEET_SIZE.toString()\r\n\t);\r\n\r\n\t// now sets the formats on this range\r\n\tdefineConditionalFormat_Adj(\"#FFFF00\", false);\t// adj first rule, overwritten by others\r\n\tif (hasExpirationDate == true) { defineConditionalFormat_ExpDate(\"#FF6565\"); }\r\n\tdefineConditionalFormat(\"fail\", \"#FF0000\");\r\n\tdefineConditionalFormat(\"EXTRA\", \"#92D050\");\r\n\tdefineConditionalFormat(\"QAHOLD\", \"FF6565\");\r\n\tdefineConditionalFormat(\"MIA\", \"#BFBFBF\");\r\n\tdefineConditionalFormat_Adj(\"#FFFF00\", true); // final adj lets it apply to just the LOTADJ column\r\n\tdefineConditionalFormat_ItemBorders();\r\n}\r\n\r\n\r\n\r\n\r\nfunction defineConditionalFormat(keyword: string, color: string){\r\n\t// Create custom from all cells on selectedSheet\r\n\tlet conditionalFormatting: ExcelScript.ConditionalFormat;\r\n\tlet condition: string;\r\n\r\n\tcondition = '=ISNUMBER(SEARCH(\\\"' + keyword + '\\\",$' + notesCol + '1))';\r\n\r\n\tconditionalFormatting = appliedRange.addConditionalFormat(ExcelScript.ConditionalFormatType.custom);\r\n\tconditionalFormatting.getCustom().getRule().setFormula(condition);\r\n\tconditionalFormatting.getCustom().getFormat().getFill().setColor(color);\r\n\tconditionalFormatting.setStopIfTrue(false);\r\n\tconditionalFormatting.setPriority(0);\r\n}\r\n\r\n\r\n\r\n\r\nfunction defineConditionalFormat_Adj(color: string, colOnly: boolean = false) {\r\n\t// Create custom from all cells on selectedSheet\r\n\tlet conditionalFormatting: ExcelScript.ConditionalFormat;\r\n\tlet condition: string;\r\n\r\n\tcondition = '=AND(ISNUMBER(SEARCH(\"LOT ADJ\",$' + lotAdjCol + '1))=FALSE, OR(ISTEXT($' + lotAdjCol + '1),ISNUMBER($' + lotAdjCol + '1)))';\r\n\r\n\t// if its just for the adjustment col, uses only the adjustment column\r\n\tif (colOnly == true) {\r\n\t\tlet adjColRange = selectedSheet.getRange(lotAdjCol + \"1:\" + lotAdjCol + MAX_EXCEL_SHEET_SIZE.toString())\r\n\t\tconditionalFormatting = adjColRange.addConditionalFormat(ExcelScript.ConditionalFormatType.custom);\r\n\t\r\n\t// otherwise uses the whole range of the table\r\n\t} else {\r\n\t\tconditionalFormatting = appliedRange.addConditionalFormat(ExcelScript.ConditionalFormatType.custom);\r\n\t}\r\n\r\n\tconditionalFormatting.getCustom().getRule().setFormula(condition);\r\n\tconditionalFormatting.getCustom().getFormat().getFill().setColor(color);\r\n\tconditionalFormatting.setStopIfTrue(false);\r\n\tconditionalFormatting.setPriority(0);\r\n}\r\n\r\n\r\n\r\n\r\nfunction defineConditionalFormat_ExpDate(color: string){\r\n\tlet conditionalFormatting: ExcelScript.ConditionalFormat;\r\n\tlet condition: string;\r\n\r\n\t// checks if expired or if today is within 1 month of the expiration date\r\n\tcondition = '=AND( ISNUMBER(DATEVALUE($' + expDateCol + '1)), (TODAY() - ($' + expDateCol + '1 - EDATE(MONTH($' + \t\t\t\t\t\t\t\t\texpDateCol + '1), 1))) > DATE(1900, 1, 0))'; \r\n\r\n\tconditionalFormatting = appliedRange.addConditionalFormat(ExcelScript.ConditionalFormatType.custom);\r\n\tconditionalFormatting.getCustom().getRule().setFormula(condition);\r\n\tconditionalFormatting.getCustom().getFormat().getFill().setColor(color);\r\n\tconditionalFormatting.setStopIfTrue(false);\r\n\tconditionalFormatting.setPriority(0);\r\n\r\n}\r\n\r\nfunction defineConditionalFormat_ItemBorders(){\r\n\tlet conditionalFormatting: ExcelScript.ConditionalFormat;\r\n\tlet condition: string;\r\n\r\n\t// checks if item number below it is same, if not, creates border\r\n\tcondition = `=\\$${itemNumCol}1 <> \\$${itemNumCol}2`;\r\n\r\n\tconditionalFormatting = appliedRange.addConditionalFormat(ExcelScript.ConditionalFormatType.custom);\r\n\tconditionalFormatting.getCustom().getRule().setFormula(condition);\r\n\tconditionalFormatting.getCustom().getFormat().getConditionalRangeBorderBottom().setStyle(ExcelScript.ConditionalRangeBorderLineStyle.continuous);\r\n\tconditionalFormatting.setStopIfTrue(false);\r\n\tconditionalFormatting.setPriority(0);\r\n\r\n}","description":"","noCodeMetadata":null,"parameterInfo":"{\"version\":1,\"originalParameterOrder\":[{\"name\":\"lotAdjustmentColumn\",\"index\":0},{\"name\":\"notesColumn\",\"index\":1},{\"name\":\"hasExpirationDate\",\"index\":2},{\"name\":\"expDateColumn\",\"index\":3},{\"name\":\"itemNumberColumn\",\"index\":4}],\"parameterSchema\":{\"type\":\"object\",\"required\":[\"lotAdjustmentColumn\",\"notesColumn\",\"hasExpirationDate\",\"expDateColumn\",\"itemNumberColumn\"],\"properties\":{\"lotAdjustmentColumn\":{\"type\":\"string\",\"enum\":[\"A\",\"B\",\"C\",\"D\",\"E\",\"F\",\"G\",\"H\",\"I\",\"J\",\"K\"],\"default\":\"E\"},\"notesColumn\":{\"type\":\"string\",\"enum\":[\"A\",\"B\",\"C\",\"D\",\"E\",\"F\",\"G\",\"H\",\"I\",\"J\",\"K\"],\"default\":\"H\"},\"hasExpirationDate\":{\"type\":\"boolean\",\"default\":false},\"expDateColumn\":{\"type\":\"string\",\"enum\":[\"A\",\"B\",\"C\",\"D\",\"E\",\"F\",\"G\",\"H\",\"I\",\"J\",\"K\"],\"default\":\"G\"},\"itemNumberColumn\":{\"type\":\"string\",\"enum\":[\"A\",\"B\",\"C\",\"D\",\"E\",\"F\",\"G\",\"H\",\"I\",\"J\",\"K\"],\"default\":\"B\"}}},\"returnSchema\":{\"type\":\"object\",\"properties\":{}},\"signature\":{\"comment\":\"\",\"parameters\":[{\"name\":\"workbook\",\"comment\":\"\"},{\"name\":\"lotAdjustmentColumn\",\"comment\":\"Please select the column for your Lot Adjustments\"},{\"name\":\"notesColumn\",\"comment\":\"Please select the your notes column (where you add MIA, FAIL, etc)\"},{\"name\":\"hasExpirationDate\",\"comment\":\"Do you want to check for expiring items?\"},{\"name\":\"expDateColumn\",\"comment\":\"Please select the column for your expiration dates.\"},{\"name\":\"itemNumberColumn\",\"comment\":\"Please select the column for your item number.\"}]}}","apiInfo":"{\"variant\":\"synchronous\",\"variantVersion\":2}"}